<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>基本概念和用法-Service与Peovider  2-7</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/public.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/style.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/pygments.css">
	<link rel="shortcut icon" href="/assets/images/logo_ioc.ico" type="images/x-icon"/>
	<link rel="icon" href="/assets/images/logo_ioc.png" type="images/png"/>
	<script src="http://libs.baidu.com/jquery/1.9.0/jquery.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	    (function($) {

	    	var temp = 0;
	    	$(document).scroll(function() {

	    		if ($(document).scrollTop() > temp) {
	    			$("#header").addClass("hide-top");
	    		} else {
	    			$("#header").removeClass("hide-top");
	    		}
	    		temp = $(document).scrollTop();
	    	});
	    	
	    	//console.log($(".menu"))
	    })(jQuery);

	</script>

</head>
<body>
    <header id="header" role="banner">
	<a id="hgroup" href="/" rel="home">
		<h1 id="logo"></h1>
		<i class="slogan" title="返回首页">
			热爱编程，关注前端开发技术
		</i>
	</a>
	<div class="connect">
		<a href="https://github.com/huanghanzhilian" class="git" target="_blank"></a>
		<a href="http://www.huanghanlian.com/feed.xml" class="rss"></a>
	</div>
	<nav id="nav">
		<ul class="menu">
			<li class="menu_item">
				<a href="/">首页</a>
			</li>
			<li class="menu_item">
				<a href="http://www.huanghanlian.com/widget/">Web组件库</a>
			</li>
			<li class="menu_item">
				<a href="http://www.huanghanlian.com/front-end-note/">前端笔记</a>
			</li>
			<li class="menu_item">
				<a href="/about/">关于本站</a>
			</li>
			<li class="menu_item">
				<a href="/report/">留言板</a>
			</li>
		</ul>
	</nav>

	<div id="m-btns">
		<div class="menu"></div>
	</div>
	<nav class="nav-bar-tabs ">
		<ul>
            <li>
              	<a href="/">首页</a>
            </li>
            <li>
              	<a href="http://www.huanghanlian.com/widget/">Web组件库</a>
            </li>
            <li>
              	<a href="http://www.huanghanlian.com/front-end-note/">前端笔记</a>
            </li>
            <li>
              	<a href="/about/">关于本站</a>
            </li>
            <li>
              	<a href="/report/">留言板</a>
            </li>
        </ul>
	</nav>
</header>
	<div id="container" class="clearfix">
	<main id="main" class="hfeed">
		<article id="post-157" class="post-157 hentry">
			<header class="entry-header">
				<h1 class="entry-title">基本概念和用法-Service与Peovider  2-7</h1>
				<div class="entry-meta">2017-03-11 <span class="dot">•</span>AngularJS<span class="dot">•</span>黄继鹏<span id="busuanzi_container_page_pv">  |  阅读量 <span id="busuanzi_value_page_pv"></span> 次</span></div>
			</header>
			<article class="post-content">
              <p>###使用$http服务</p>

<pre><code class="language-html">&lt;html ng-app="MyModule"&gt;
	&lt;head&gt;
		&lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;
		&lt;script src="framework/angular-1.3.0.14/angular.js"&gt;&lt;/script&gt;
		&lt;script src="HTTPBasic.js"&gt;&lt;/script&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;div ng-controller="LoadDataCtrl"&gt;
			&lt;ul&gt;
				&lt;li ng-repeat="user in users"&gt;
					
				&lt;/li&gt;
			&lt;/ul&gt;
		&lt;/div&gt;
	&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>有ng-controller叫做LoadDataCtrl，</p>

<p>这个ng-controller有个列表<code>ng-repeat</code>将数组循环出来。</p>

<p><code>ng-repeat="user in users"</code>这里的<code>users</code>数据不再是像前面写列子一样写死在代码里面，希望通过后台去加载进来，</p>

<pre><code class="language-javascript">var myModule=angular.module("MyModule",[]);
myModule.controller('LoadDataCtrl', ['$scope','$http', function($scope,$http){
	$http({
        method: 'GET',
        url: 'data.json'
    }).success(function(data, status, headers, config) {
        console.log("success...");
        console.log(data);
        $scope.users=data;
    }).error(function(data, status, headers, config) {
        console.log("error...");
    });
}]);
</code></pre>

<p>调用AngularJS里面的<code>$http</code>这个服务，</p>

<p><code>method: 'GET',</code>  数据交互方式<code>GET或POST</code></p>

<p><code>url: 'data.json'</code>要请求哪个地址。</p>

<p><code>success</code>成功后执行函数</p>

<p><code>error</code>请求错误执行函数</p>

<p>这里请求的是<code>json</code>文件</p>

<pre><code class="language-json">[{
    "name": "《用AngularJS开发下一代WEB应用》"
},{
    "name": "《Ext江湖》"
},{
    "name": "《ActionScript3.0游戏设计基础（第二版）》"
}]

</code></pre>

<p>拿到这些数据以后把他<code>$scope.users</code>上面去</p>

<p><code>$scope.users=data;</code></p>

<p>###创建自己的Service</p>

<pre><code class="language-html">&lt;html ng-app="MyServiceApp"&gt;

&lt;head&gt;
    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;
    &lt;link rel="stylesheet" href="framework/bootstrap-3.0.0/css/bootstrap.css"&gt;
    &lt;script src="framework/angular-1.3.0.14/angular.js"&gt;&lt;/script&gt;
    &lt;script src="MyService1.js"&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;div ng-controller="ServiceController"&gt;
        &lt;label&gt;用户名&lt;/label&gt;
        &lt;input type="text" ng-model="username" placeholder="请输入用户名" /&gt;
        &lt;pre ng-show="username"&gt;&lt;/pre&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;

</code></pre>

<p>有一个<code>inout</code>他的<code>ng-model</code>等于<code>username</code></p>

<p>要实现的效果是当输入项内容发生变化的时候就去向后台发起请求，</p>

<pre><code class="language-javascript">var myServiceApp = angular.module("MyServiceApp", []);
myServiceApp.factory('userListService', ['$http',
    function($http) {
        var doRequest = function(username, path) {
            return $http({
                method: 'GET',
                url: 'users.json'
            });
        }
        return {
            userList: function(username) {
                return doRequest(username, 'userList');
            }
        };
    }
]);

myServiceApp.controller('ServiceController', ['$scope', '$timeout', 'userListService',
    function($scope, $timeout, userListService) {
        var timeout;
        $scope.$watch('username', function(newUserName) {
            if (newUserName) {
                if (timeout) {
                    $timeout.cancel(timeout);
                }
                timeout = $timeout(function() {
                    userListService.userList(newUserName)
                        .success(function(data, status) {
                            $scope.users = data;
                        });
                }, 350);
            }
        });
    }
]);

//...
</code></pre>

<p>AngularJS封装了叫<code>$watch</code>用来监控一个数据模型的变化，这里利用<code>$watch</code>来监听，</p>

<p>监听<code>username</code>他发生变化以后执行一个匿名函数，这个函数里面来检测是不是拿到新的<code>newUserName</code>如果拿到新的值就向后台去发送请求，</p>

<p>那么调用谁去发请求呢？就调用自己封装的<code>userListService</code></p>

<p>这个地方有一个比较绕的东西叫做<code>'$timeout'</code></p>

<p>这个<code>'$timeout'</code>就是说当我们在页面上进行输入的时候不是说我们每次按下减排他就去请求后台，如果这样的话会发现页面会抖动，假如说每按下一个键他就去向后台发起请求，很显然页面会不断地狂刷，</p>

<p>这个时候加一个防止抖动的处理，这是比较常见的动作，只有当你<code>350</code>毫秒不再按下一个按键的时候，就是说延迟350毫秒没有按下，这个时候他才会去向后台发起请求。</p>

<p>当你连续按键的时候，并不会向后台连续发送请求，</p>

<p>最后调用的函数是<code>userListService.userList</code>这个函数，</p>

<p>自己定义的<code>Service</code>和AngularJS内置的<code>Service</code>有两点不同点，</p>

<p>一种是我们自己定义的<code>Service</code>他的命名不要用<code>$</code>打头，</p>

<p>第二我们自己定义的<code>Service</code>也是可以向AngularJS内置的服务一样去进行注入的，但是注入的时候有一个不同的地方，就是说我们自己定义的<code>Service</code>是必须放在最后一个的，</p>

<p>有了这个<code>Service</code>以后，假设要做相同的操作就可以去一直去调用它，很多的<code>controller</code>控制器都可以去共用的，从而实现了这个功能的复用，</p>

<p>比如说我要把<code>userListService</code>抽出作为自己的服务，这个Servuce里面会去返回<code>userList</code>用户列表数据。</p>

<p>把它抽成一个服务之后，其他的控制器就可以调用它，</p>

<p>项目中控制器会有很多，如果有控制器之间有代码相同，那么就可以抽到Servuce服务里面，方便调用。</p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-fffa1f271901c615.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png" /></p>

<p>###Service的特性</p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-bdf22fc399e21f2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png" /></p>

<p>###Service，Factory，Porvider，本质上都是Porvider</p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-79e457e466cc4831.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png" /></p>

<p>###使用$filter</p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-8ca8222843d1b55f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png" /></p>

<p>###其他内置Service介绍</p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-af691fa30e840a78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png" /></p>

              <!-- 多说评论框 start -->
              		<!-- <span class="ds-thread-count" data-thread-key="/angularjs/2017/03/11/angularjs_basics9" data-count-type="comments"></span> -->
					<div class="ds-thread" data-thread-key="http://www.huanghanlian.com/angularjs/2017/03/11/angularjs_basics9" data-title="基本概念和用法-Service与Peovider  2-7" data-url="http://www.huanghanlian.com/angularjs/2017/03/11/angularjs_basics9"></div>
				<!-- 多说评论框 end -->
				<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
				<script type="text/javascript">
				var duoshuoQuery = {short_name:"huanghuanlian"};
					(function() {
						var ds = document.createElement('script');
						ds.type = 'text/javascript';ds.async = true;
						ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
						ds.charset = 'UTF-8';
						(document.getElementsByTagName('head')[0]
						 || document.getElementsByTagName('body')[0]).appendChild(ds);
					})();
				</script>
				<!-- 多说公共JS代码 end -->


				
            </article>
		</article>

	</main>
	<div class="sidebar" id="sidebar">
	<div class="sidebar-top">
		<aside class="widjhuh">
			<h3 class="widget-title">最新文章</h3>
			<ul class="minty_thumblist">
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics10.html">

                    	<span>基本概念和用法-综合应用BookStore  2-8</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics8.html">

                    	<span>基本概念和用法-指令 2-6</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics7.html">

                    	<span>基本概念和用法-路由 2-5</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics6.html">

                    	<span>基本概念和用法-双向数据绑定 2-4</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics5.html">

                    	<span>基本概念和用法-路由，模块，依赖注入 2-3</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics4.html">

                    	<span>基本概念和用法-MVC 2-2</span>
                    </a>
                  </li>
				
			</ul>
		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">最近访客</h3>
			<ul class="minty_thumblist minty_thumblist_a ds-recent-visitors visitorsopi" data-num-items="20" data-avatar-size="38">

			</ul>

		    <!--多说js加载开始，一个页面只需要加载一次 -->
		    <script type="text/javascript">
		    var duoshuoQuery = {short_name:"huanghuanlian"};
		    (function() {
		        var ds = document.createElement('script');
		        ds.type = 'text/javascript';ds.async = true;
		        ds.src = 'http://static.duoshuo.com/embed.js';
		        ds.charset = 'UTF-8';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
		    })();
		    </script>
		    <!--多说js加载结束，一个页面只需要加载一次 -->

		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">分类目录</h3>
			<ul class="minty_thumblist minty_thumblist_a">
				
				<li>
					<a href="/categories/Markdown/" title="view all
posts">
						Markdown (2)
					</a>
				</li>
				
				<li>
					<a href="/categories/Canvas/" title="view all
posts">
						Canvas (1)
					</a>
				</li>
				
				<li>
					<a href="/categories/Git/" title="view all
posts">
						Git (1)
					</a>
				</li>
				
				<li>
					<a href="/categories/JavaScript/" title="view all
posts">
						JavaScript (30)
					</a>
				</li>
				
				<li>
					<a href="/categories/AngularJS/" title="view all
posts">
						AngularJS (10)
					</a>
				</li>
				
			</ul>
		</aside>
	</div>


	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">标签目录</h3>
			<div class="tagcloud" id="tagcloud">
				
					<a href="/tag/Markdown/" title="view all
posts">
						Markdown
					</a>
				
					<a href="/tag/Canvas/" title="view all
posts">
						Canvas
					</a>
				
					<a href="/tag/Git/" title="view all
posts">
						Git
					</a>
				
					<a href="/tag/JavaScript/" title="view all
posts">
						JavaScript
					</a>
				
					<a href="/tag/RegExp/" title="view all
posts">
						RegExp
					</a>
				
					<a href="/tag/DOM/" title="view all
posts">
						DOM
					</a>
				
					<a href="/tag/BOM/" title="view all
posts">
						BOM
					</a>
				
					<a href="/tag/__proto__/" title="view all
posts">
						__proto__
					</a>
				
					<a href="/tag/Ajax/" title="view all
posts">
						Ajax
					</a>
				
					<a href="/tag/AngularJS/" title="view all
posts">
						AngularJS
					</a>
				
			</div>

		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">友情链接</h3>
			<ul class="minty_thumblist minty_thumblist_a">

				<li>
					<a href="http://blog.csdn.net/u013861109?viewmode=contents" target="blank">
						csdn博客
					</a>
				</li>
				<li>
					<a href="http://www.imooc.com/" target="blank">
						慕课网
					</a>
				</li>
				<li>
					<a href="http://www.dglives.com/" target="blank">
						数字生活前端
					</a>
				</li>
				<li>
					<a href="http://www.jianshu.com/" target="blank">
						简书
					</a>
				</li>
				<li>
					<a href="http://www.runoob.com/" target="blank">
						菜鸟
					</a>
				</li>
				<li>
					<a href="http://www.qdfuns.com/" target="blank">
						前端网
					</a>
				</li>
			</ul>
		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">QQ交流群</h3>
			<img style="margin-top: 10px; box-shadow: none;" src="/assets/images/ertw.png">
		</aside>
	</div>


	<script>
	var box=document.getElementById("tagcloud").getElementsByTagName("a");
	for(var i=0;i<box.length;i++){
		var a =Math.round(Math.random()*20)/10;
		box[i].style.fontSize=a+'em';
	}
	</script>

</div>
</div>
	<footer id="footer">
	<nav class="links">
		<a href="">作品</a>
		<a href="/about/">关于本站</a>
		<a href="/report/">留言板</a>
	</nav>
	<div class="copyright">
		© 2016 <a href="">继小鹏的前端博客</a>
	</div>
	<a href="javascript:pageScroll();" id="rocket" class=""></a>
	<span id="busuanzi_container_site_pv">
	    本站总访问量<span id="busuanzi_value_site_pv"></span>次
	</span>
	<span id="busuanzi_container_site_uv">
	  本站访客数<span id="busuanzi_value_site_uv"></span>人次
	</span>
</footer>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script>

$(function(){
	$("#m-btns").click(function(){
		if($("body").hasClass('nav-is-open')){
			$("body").removeClass('nav-is-open')
		}else{
			$("body").addClass('nav-is-open')
		};
	})
})
var fhdb = document.getElementById("rocket");

//获取页面可视区高度
var dqy = document.documentElement.clientHeight;

var main_left=$('#main').offset().left+$('#main').width()+16;

//滚动条滚动时触发   在滚动的时候触发
window.onscroll = function() {
	var sTop = document.documentElement.scrollTop || document.body.scrollTop;
	if (sTop >= dqy) {
		$("#rocket").addClass('show');
	} else {
		$("#rocket").removeClass('show');
	}
}

function pageScroll() {
	//把内容滚动指定的像素数（第一个参数是向右滚动的像素数，第二个参数是向下滚动的像素数）
	window.scrollBy(0, -100);
	//延时递归调用，模拟滚动向上效果
	scrolldelay = setTimeout('pageScroll()', 5);
	//获取scrollTop值，声明了DTD的标准网页取document.documentElement.scrollTop，否则取document.body.scrollTop；因为二者只有一个会生效，另一个就恒为0，所以取和值可以得到网页的真正的scrollTop值
	var sTop = document.documentElement.scrollTop + document.body.scrollTop;
	//判断当页面到达顶部，取消延时代码（否则页面滚动到顶部会无法再向下正常浏览页面）
	if (sTop == 0) clearTimeout(scrolldelay)

}



</script>
</body>
</html>