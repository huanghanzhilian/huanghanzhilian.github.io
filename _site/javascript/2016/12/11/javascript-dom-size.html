<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>JavaScript获取DOM元素位置和尺寸大小</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/public.css">
	<link rel="stylesheet" type="text/css" href="/assets/css/style.css">
	<!-- <link rel="stylesheet" type="text/css" href="/assets/css/pygments.css"> -->
	<link rel="shortcut icon" href="/assets/images/logo_ioc.ico" type="images/x-icon"/>
	<link rel="icon" href="/assets/images/logo_ioc.png" type="images/png"/>
	<script src="http://libs.baidu.com/jquery/1.9.0/jquery.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	    (function($) {

	    	var temp = 0;
	    	$(document).scroll(function() {

	    		if ($(document).scrollTop() > temp) {
	    			$("#header").addClass("hide-top");
	    		} else {
	    			$("#header").removeClass("hide-top");
	    		}
	    		temp = $(document).scrollTop();
	    	});
	    	
	    	//console.log($(".menu"))
	    })(jQuery);

	</script>

</head>
<body>
    <header id="header" role="banner">
	<a id="hgroup" href="/" rel="home">
		<h1 id="logo"></h1>
		<i class="slogan" title="返回首页">
			热爱编程，关注前端开发技术
		</i>
	</a>
	<div class="connect">
		<a href="https://github.com/huanghanzhilian" class="git" target="_blank"></a>
		<a href="http://www.huanghanlian.com/feed.xml" class="rss"></a>
	</div>
	<nav id="nav">
		<ul class="menu">
			<li class="menu_item">
				<a href="/">首页</a>
			</li>
			<li class="menu_item">
				<a href="http://www.huanghanlian.com/widget/">Web组件库</a>
			</li>
			<li class="menu_item">
				<a href="http://www.huanghanlian.com/front-end-note/">前端笔记</a>
			</li>
			<li class="menu_item">
				<a href="/about/">关于本站</a>
			</li>
			<li class="menu_item">
				<a href="/report/">留言板</a>
			</li>
		</ul>
	</nav>

	<div id="m-btns">
		<div class="menu"></div>
	</div>
	<nav class="nav-bar-tabs ">
		<ul>
            <li>
              	<a href="/">首页</a>
            </li>
            <li>
              	<a href="http://www.huanghanlian.com/widget/">Web组件库</a>
            </li>
            <li>
              	<a href="http://www.huanghanlian.com/front-end-note/">前端笔记</a>
            </li>
            <li>
              	<a href="/about/">关于本站</a>
            </li>
            <li>
              	<a href="/report/">留言板</a>
            </li>
        </ul>
	</nav>
</header>
	<div id="container" class="clearfix">
	<main id="main" class="hfeed">
		<article id="post-157" class="post-157 hentry">
			<header class="entry-header">
				<h1 class="entry-title">JavaScript获取DOM元素位置和尺寸大小</h1>
				<div class="entry-meta">2016-12-11 <span class="dot">•</span>JavaScript<span class="dot">•</span>黄继鹏<span id="busuanzi_container_page_pv">  |  阅读量 <span id="busuanzi_value_page_pv"></span> 次</span></div>
			</header>
			<article class="post-content">
              <p>在一些复杂的页面中经常会用JavaScript处理一些DOM元素的动态效果，这种时候我们经常会用到一些元素位置和尺寸的计算，浏览器兼容性问题也是不可忽略的一部分，要想写出预想效果的JavaScript代码，我们需要了解一些基本知识。</p>

<h4>基础概念</h4>

<p>为了方便理解，我们需要了解几个基础概念，每个HTML元素都有下列属性</p>

<p>offset| client| scroll
----|------|----
offsetWidth| clientWidth| scrollWidth
offsetHeight| clientHeight| scrollHeight
offsetLeft| clientLeft| scrollLeft
offsetTop| clientTop| scrollTop</p>

<blockquote>
<p>clientHeight和clientWidth用于描述元素内尺寸，是指 元素内容+内边距 大小，不包括边框（IE下实际包括）、外边距、滚动条部分</p>

<p>offsetHeight和offsetWidth用于描述元素外尺寸，是指 元素内容+内边距+边框，不包括外边距和滚动条部分</p>

<p>clientTop和clientLeft返回内边距的边缘和边框的外边缘之间的水平和垂直距离，也就是左，上边框宽度</p>

<p>offsetTop和offsetLeft表示该元素的左上角（边框外边缘）与已定位的父容器（offsetParent对象）左上角的距离
offsetParent对象是指元素最近的定位（relative,absolute）祖先元素，递归上溯，如果没有祖先元素是定位的话，会返回null</p>
</blockquote>

<p>写个小例子方便理解</p>
<div class="highlight"><pre><code class="language-" data-lang="">&lt;div id="divParent" style="padding: 18px; background-color: #aaa; position: relative;"&gt;
    &lt;div id="divDisplay" style="background-color: #0f0; margin: 30px; padding: 10px;
        height: 200px; width: 200px; border: solid 10px #f00;"&gt;
    &lt;/div&gt;
&lt;/div&gt;



var div = document.getElementById('divDisplay');

var clientHeight = div.clientHeight;
var clientWidth = div.clientWidth;
div.innerHTML += 'clientHeight: ' + clientHeight + '&lt;br/&gt;';
div.innerHTML += 'clientWidth: ' + clientWidth + '&lt;br/&gt;';

var clientLeft = div.clientLeft;
var clientTop = div.clientTop;
div.innerHTML += 'clientLeft: ' + clientLeft + '&lt;br/&gt;';
div.innerHTML += 'clientTop: ' + clientTop + '&lt;br/&gt;';

var offsetHeight = div.offsetHeight;
var offsetWidth = div.offsetWidth;
div.innerHTML += 'offsetHeight: ' + offsetHeight + '&lt;br/&gt;';
div.innerHTML += 'offsetWidth: ' + offsetWidth + '&lt;br/&gt;';

var offsetLeft = div.offsetLeft;
var offsetTop = div.offsetTop;
div.innerHTML += 'offsetLeft: ' + offsetLeft + '&lt;br/&gt;';
div.innerHTML += 'offsetTop: ' + offsetTop + '&lt;br/&gt;';

var offsetParent = div.offsetParent;
div.innerHTML += 'offsetParent: ' + offsetParent.id + '&lt;br/&gt;';
</code></pre></div>
<p>效果如图</p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-4c16b0f2a5f14f47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-f29eb579a580df62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>

<p>从图中我们可以看到，clientHeight就是div的高度+上下各10px的padding，clientWidth同理</p>

<p>而clientLeft和ClientTop即为div左、上边框宽度</p>

<p>offsetHeight是clientHeight+上下个3px的边框宽度之和，offsetWidth同理</p>

<p>offsetTop是div 30px的 maggin+offsetparent 8px的 padding，offsetLeft同理</p>

<blockquote>
<p>6.scrollWidth和scrollHeight是元素的内容区域加上内边距加上溢出尺寸，当内容正好和内容区域匹配没有溢出时，这些属性与clientWidth和clientHeight相等</p>

<p>7.scrollLeft和scrollTop是指元素滚动条位置，它们是<strong>可写</strong>的</p>
</blockquote>

<p>下面写个简单例子理解</p>
<div class="highlight"><pre><code class="language-" data-lang="">&lt;div id="divParent" style="background-color: #aaa; padding:8px; border:solid 7px #000; height:200px; width:500px; overflow:auto;"&gt;
    &lt;div id="divDisplay" style="background-color: #0f0; margin: 30px; padding: 10px;
        height: 400px; width: 200px; border: solid 3px #f00;"&gt;
    &lt;/div&gt;
&lt;/div&gt;



var divP = document.getElementById('divParent');
var divD = document.getElementById('divDisplay');

var scrollHeight = divP.scrollHeight;
var scrollWidth = divP.scrollWidth;
divD.innerHTML += 'scrollHeight: ' + scrollHeight + '&lt;br/&gt;';
divD.innerHTML += 'scrollWidth: ' + scrollWidth + '&lt;br/&gt;';
</code></pre></div>
<p>效果图</p>

<p><img src="http://upload-images.jianshu.io/upload_images/3877962-fc19f4bb6fe78aa6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>

<p>在FireFox和IE10（IE10以下版本盒模型和W3C标准不一致，不加讨论，兼容性问题下面会介绍到）下得到结果scrollHeight: <strong>494</strong>，而在Chrome和Safari下得到结果scrollHeight: <strong>502</strong>，差了8px，根据8可以简单推测是divParent的padding，来算一下是不是</p>

<p>我们可以看看它们的结果是怎么来的，首先scrollHeight肯定包含了divDisplay所需的高度 400px的高度+上下各10px的padding+上下各3px的border+上下各30px的margin，这样</p>

<p>400+10<em>2+3</em>2+30*2=486</p>

<p>这样486+8=494， 486+8<em>2=502果真是这样，</em><em>在FireFox和IE10下没有计算下padding</em>*</p>

<p>有了这些基础知识后，我们就可以计算元素的位置和尺寸了。</p>

<h4>相对于文档与视口的坐标</h4>

<p>当我们计算一个DOM元素位置也就是坐标的时候，会涉及到两种坐标系，<strong>文档坐标</strong>和<strong>视口坐标</strong>。</p>

<p>我们经常用到的<strong>document就是整个页面部分，而不仅仅是窗口可见部分</strong>，还包括因为窗口大小限制而出现滚动条的部分，它的左上角就是我们所谓相对于文档坐标的原点。</p>

<p><strong>视口是显示文档内容的浏览器的一部分，它不包括浏览器外壳</strong>（菜单，工具栏，状态栏等），也就是当前窗口显示页面部分，不包括滚动条。</p>

<p>如果文档比视口小，说明没有出现滚动，文档左上角和视口左上角相同，一般来讲在两种坐标系之间进行切换，需要加上或减去滚动的偏移量（scroll offset）。</p>

<p>为了在坐标系之间进行转换，我们需要判定浏览器窗口的滚动条位置。window对象的pageXoffset和pageYoffset提供这些值，IE 8及更早版本除外。也可以通过scrollLeft和scrollTop属性获得滚动条位置，正常情况下通过查询文档根节点（document.documentElement）来获得这些属性值，但在怪异模式下必须通过文档的body上查询。</p>
<div class="highlight"><pre><code class="language-" data-lang="">function getScrollOffsets(w) {
    var w = w || window;
    if (w.pageXoffset != null) {
        return {
            x: w.pageXoffset,
            y: pageYoffset
        };
    }
    var d = w.document;
    if (document.compatMode == "CSS1Compat")
        return {
            x: d.documentElement.scrollLeft,
            y: d.documentElement.scrollTop
        };
    return {
        x: d.body.scrollLeft,
        y: d.body.scrollTop
    };
}
</code></pre></div>
<p>有时候能够判断视口的尺寸也是非常有用的</p>
<div class="highlight"><pre><code class="language-" data-lang="">function getViewPortSize(w) {
    var w = w || window;
    if (w.innerWidth != null)
        return {
            w: w.innerWidth,
            h: w.innerHeight
        };
    var d = w.document;
    if (document.compatMode == "CSS1Compat")
        return {
            w: d.documentElement.clientWidth,
            h: d.documentElement.clientHeight
        };
    return {
        w: d.body.clientWidth,
        h: d.body.clientHeight
    };
}
</code></pre></div>
<p><strong>文档坐标</strong></p>

<p>任何HTML元素都拥有offectLeft和offectTop属性返回元素的X和Y坐标，对于很多元素，这些值是文档坐标，但是对于以定位元素后代及一些其他元素（表格单元），返回相对于<strong>祖先</strong>的坐标。我们可以通过简单的递归上溯累加计算</p>
<div class="highlight"><pre><code class="language-" data-lang="">function getElementPosition(e) {
    var x = 0,
        y = 0;
    while (e != null) {
        x += e.offsetLeft;
        y += e.offsetTop;
        e = e.offsetParent;
    }
    return {
        x: x,
        y: y
    };
}
</code></pre></div>
<p>尽管如此，这个函数也不总是计算正确的值，当文档中含有滚动条的时候这个方法就不能正常工作了，我们只能在没有滚动条的情况下使用这个方法，不过我们用这个原理算出一些元素相对于某个父元素的坐标。</p>

<p><strong>视口坐标</strong></p>

<p>计算<strong>视口坐标</strong>就相对简单了很多，可以通过调用<strong>元素</strong>的<strong>getBoundingClientRect</strong>方法。方法返回一个有left、right、top、bottom属性的对象，分别表示元素四个位置的相对于视口的坐标。<strong>getBoundingClientRect所返回的坐标包含元素的内边距和边框</strong>，不包含外边距。兼容性很好，非常好用</p>

<p><strong>元素尺寸</strong></p>

<p>由上面计算坐标方法，我们可以方便得出元素尺寸。在符合W3C标准的浏览器中getBoundingClientRect返回的对象还包括width和height,但在原始IE中未实现，但是通过返回对象的right-left和bottom-top可以方便计算出。</p>

              <!-- 多说评论框 start -->
              		<!-- <span class="ds-thread-count" data-thread-key="/javascript/2016/12/11/javascript_dom_size" data-count-type="comments"></span> -->
					<div class="ds-thread" data-thread-key="http://www.huanghanlian.com/javascript/2016/12/11/javascript_dom_size" data-title="JavaScript获取DOM元素位置和尺寸大小" data-url="http://www.huanghanlian.com/javascript/2016/12/11/javascript_dom_size"></div>
				<!-- 多说评论框 end -->
				<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
				<script type="text/javascript">
				var duoshuoQuery = {short_name:"huanghuanlian"};
					(function() {
						var ds = document.createElement('script');
						ds.type = 'text/javascript';ds.async = true;
						ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
						ds.charset = 'UTF-8';
						(document.getElementsByTagName('head')[0]
						 || document.getElementsByTagName('body')[0]).appendChild(ds);
					})();
				</script>
				<!-- 多说公共JS代码 end -->


				
            </article>
		</article>

	</main>
	<div class="sidebar" id="sidebar">
	<div class="sidebar-top">
		<aside class="widjhuh">
			<h3 class="widget-title">最新文章</h3>
			<ul class="minty_thumblist">
				
                  <li>
                    <a href="/php/2017/03/14/phpzendstudio.html">

                    	<span>PHP概述-环境配置</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/php/2017/03/13/php-study2.html">

                    	<span>PHP进阶-函数(2)</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/php/2017/03/13/php-study1.html">

                    	<span>PHP进阶-数组(1)</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics10.html">

                    	<span>基本概念和用法-综合应用BookStore  2-8</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics9.html">

                    	<span>基本概念和用法-Service与Peovider  2-7</span>
                    </a>
                  </li>
				
                  <li>
                    <a href="/angularjs/2017/03/11/angularjs-basics8.html">

                    	<span>基本概念和用法-指令 2-6</span>
                    </a>
                  </li>
				
			</ul>
		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">最近访客</h3>
			<ul class="minty_thumblist minty_thumblist_a ds-recent-visitors visitorsopi" data-num-items="20" data-avatar-size="38">

			</ul>

		    <!--多说js加载开始，一个页面只需要加载一次 -->
		    <script type="text/javascript">
		    var duoshuoQuery = {short_name:"huanghuanlian"};
		    (function() {
		        var ds = document.createElement('script');
		        ds.type = 'text/javascript';ds.async = true;
		        ds.src = 'http://static.duoshuo.com/embed.js';
		        ds.charset = 'UTF-8';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
		    })();
		    </script>
		    <!--多说js加载结束，一个页面只需要加载一次 -->

		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">分类目录</h3>
			<ul class="minty_thumblist minty_thumblist_a">
				
				<li>
					<a href="/categories/Markdown/" title="view all
posts">
						Markdown (2)
					</a>
				</li>
				
				<li>
					<a href="/categories/Canvas/" title="view all
posts">
						Canvas (1)
					</a>
				</li>
				
				<li>
					<a href="/categories/Git/" title="view all
posts">
						Git (1)
					</a>
				</li>
				
				<li>
					<a href="/categories/JavaScript/" title="view all
posts">
						JavaScript (30)
					</a>
				</li>
				
				<li>
					<a href="/categories/AngularJS/" title="view all
posts">
						AngularJS (10)
					</a>
				</li>
				
				<li>
					<a href="/categories/PHP/" title="view all
posts">
						PHP (3)
					</a>
				</li>
				
			</ul>
		</aside>
	</div>


	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">标签目录</h3>
			<div class="tagcloud" id="tagcloud">
				
					<a href="/tag/Markdown/" title="view all
posts">
						Markdown
					</a>
				
					<a href="/tag/Canvas/" title="view all
posts">
						Canvas
					</a>
				
					<a href="/tag/Git/" title="view all
posts">
						Git
					</a>
				
					<a href="/tag/JavaScript/" title="view all
posts">
						JavaScript
					</a>
				
					<a href="/tag/RegExp/" title="view all
posts">
						RegExp
					</a>
				
					<a href="/tag/DOM/" title="view all
posts">
						DOM
					</a>
				
					<a href="/tag/BOM/" title="view all
posts">
						BOM
					</a>
				
					<a href="/tag/proto/" title="view all
posts">
						proto
					</a>
				
					<a href="/tag/Ajax/" title="view all
posts">
						Ajax
					</a>
				
					<a href="/tag/AngularJS/" title="view all
posts">
						AngularJS
					</a>
				
					<a href="/tag/PHP_study/" title="view all
posts">
						PHP_study
					</a>
				
					<a href="/tag/PHP/" title="view all
posts">
						PHP
					</a>
				
			</div>

		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">友情链接</h3>
			<ul class="minty_thumblist minty_thumblist_a">

				<li>
					<a href="http://blog.csdn.net/u013861109?viewmode=contents" target="blank">
						csdn博客
					</a>
				</li>
				<li>
					<a href="http://www.imooc.com/" target="blank">
						慕课网
					</a>
				</li>
				<li>
					<a href="http://www.dglives.com/" target="blank">
						数字生活前端
					</a>
				</li>
				<li>
					<a href="http://www.jianshu.com/" target="blank">
						简书
					</a>
				</li>
				<li>
					<a href="http://www.runoob.com/" target="blank">
						菜鸟
					</a>
				</li>
				<li>
					<a href="http://www.qdfuns.com/" target="blank">
						前端网
					</a>
				</li>
			</ul>
		</aside>
	</div>

	<div class="sidebar-top">
		<aside class="widjhuh clearfix">
			<h3 class="widget-title">QQ交流群</h3>
			<img style="margin-top: 10px; box-shadow: none;" src="/assets/images/ertw.png">
		</aside>
	</div>


	<script>
	var box=document.getElementById("tagcloud").getElementsByTagName("a");
	for(var i=0;i<box.length;i++){
		var a =Math.round(Math.random()*20)/10;
		box[i].style.fontSize=a+'em';
	}
	</script>

</div>
</div>
	
<footer id="footer">
	<nav class="links">
		<a href="">作品</a>
		<a href="/about/">关于本站</a>
		<a href="/report/">留言板</a>
	</nav>
	<div class="copyright">
		© 2016 <a href="">继小鹏的前端博客</a>
	</div>
	<a href="javascript:pageScroll();" id="rocket" class=""></a>
	<span id="busuanzi_container_site_pv">
	    本站总访问量<span id="busuanzi_value_site_pv"></span>次
	</span>
	<span id="busuanzi_container_site_uv">
	  本站访客数<span id="busuanzi_value_site_uv"></span>人次
	</span>
</footer>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script>

$(function(){
	$("#m-btns").click(function(){
		if($("body").hasClass('nav-is-open')){
			$("body").removeClass('nav-is-open')
		}else{
			$("body").addClass('nav-is-open')
		};
	})
})
var fhdb = document.getElementById("rocket");

//获取页面可视区高度
var dqy = document.documentElement.clientHeight;

var main_left=$('#main').offset().left+$('#main').width()+16;

//滚动条滚动时触发   在滚动的时候触发
window.onscroll = function() {
	var sTop = document.documentElement.scrollTop || document.body.scrollTop;
	if (sTop >= dqy) {
		$("#rocket").addClass('show');
	} else {
		$("#rocket").removeClass('show');
	}
}

function pageScroll() {
	//把内容滚动指定的像素数（第一个参数是向右滚动的像素数，第二个参数是向下滚动的像素数）
	window.scrollBy(0, -100);
	//延时递归调用，模拟滚动向上效果
	scrolldelay = setTimeout('pageScroll()', 5);
	//获取scrollTop值，声明了DTD的标准网页取document.documentElement.scrollTop，否则取document.body.scrollTop；因为二者只有一个会生效，另一个就恒为0，所以取和值可以得到网页的真正的scrollTop值
	var sTop = document.documentElement.scrollTop + document.body.scrollTop;
	//判断当页面到达顶部，取消延时代码（否则页面滚动到顶部会无法再向下正常浏览页面）
	if (sTop == 0) clearTimeout(scrolldelay)

}



</script>
</body>
</html>